<!--
README: ZKP & ZKML 可視化デモ（単一HTML / オフライン）
使い方:
  1) このファイルをブラウザで開きます
  2) 上部タブで「解説＆比較 / ZKP / ZKML / まとめ」を切り替えます
  3) 各デモの左パネルを操作すると、右の図と"制約ライト"が連動します
  4) 「秘密は守る、検証は通す」の概念を直感的に体験できます

意図:
  金融×AI教育の文脈で、ゼロ知識証明(ZKP)とゼロ知識機械学習(ZKML)の
  核心的なアイデアを、数式や暗号理論の専門知識なしに理解できるよう設計しました。
  「操作できる図」を通じて、証明のロジックと実用的なメリットを体感できます。

制約:
  本デモは教育用の概念可視化です。暗号学的に厳密・安全なプロトコルは実装していません。
  実際のZKP/ZKMLシステムは、はるかに複雑な数学に基づいています。
  すべてのコードは単一ファイルにまとめられており、外部ライブラリへの依存はありません。

【実際に暗号学的なZKP/ZKMLを実装する場合のヒント】
  - 本デモは「概念の可視化」に特化しており、実際の証明生成・検証アルゴリズムは含みません。
  - 実際のZKP/ZKML実装には、以下のような要素が必要です:
    1. 算術回路（Arithmetic Circuits）：計算を有限体上の演算として表現
    2. 制約システム：多項式制約やコピー制約など
    3. 証明システム：zk-SNARKsやzk-STARKs等の暗号プロトコル
    4. 楕円曲線暗号：証明生成・検証のための基盤技術
    5. 専用言語/フレームワーク：Circom、Rust+halo2など
  - 実際のZKMLでは、MLモデルの各レイヤーや活性化関数を算術回路に変換し、証明生成には数分〜数時間かかる場合もあります。
  - 教育用デモとして「秘密は守る／検証は通す」の直感を体験できますが、実務やプロダクト開発には専門的な暗号ライブラリが必要です。
-->
<!doctype html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZKP & ZKML 可視化デモ</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --success-color: #28a745;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
            --light-color: #f8f9fa;
            --dark-color: #343a40;
            --border-color: #dee2e6;
            --public-color: #d4edda;
            --private-color: #f8d7da;
            --constraint-on: #28a745;
            --constraint-off: #6c757d;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: var(--light-color);
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        header {
            background: linear-gradient(135deg, var(--primary-color), var(--info-color));
            color: white;
            padding: 1.5rem;
            text-align: center;
        }

        header h1 {
            margin: 0;
            font-size: 2rem;
            font-weight: 300;
        }

        header p {
            margin: 0.5rem 0 0 0;
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .tabs {
            display: flex;
            background-color: #f1f3f4;
            border-bottom: 2px solid var(--border-color);
        }

        .tab-button {
            flex: 1;
            background: none;
            border: none;
            padding: 1rem;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
            color: var(--dark-color);
        }

        .tab-button:hover {
            background-color: rgba(0,123,255,0.1);
        }

        .tab-button.active {
            background-color: white;
            border-bottom-color: var(--primary-color);
            font-weight: bold;
        }

        .tab-content {
            display: none;
            padding: 2rem;
        }

        .tab-content.active {
            display: block;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 2rem;
        }

        .demo-section {
            border: 1px solid var(--border-color);
            border-radius: 8px;
            overflow: hidden;
            background: white;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .demo-header {
            background: var(--light-color);
            padding: 1rem;
            border-bottom: 1px solid var(--border-color);
        }

        .demo-header h3 {
            margin: 0;
            color: var(--primary-color);
        }

        .demo-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            min-height: 400px;
        }

        .controls {
            padding: 1.5rem;
            background: #fafbfc;
            border-right: 1px solid var(--border-color);
        }

        .visualization {
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        #boundary-legend {
            width: 300px;
            margin: 0.5rem 0;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            font-size: 0.9rem;
        }

        #boundary-legend .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.25rem;
        }

        #boundary-legend .legend-line {
            width: 20px;
            height: 2px;
            background: #007bff;
            margin-right: 0.5rem;
        }

        #boundary-legend .legend-box {
            width: 20px;
            height: 10px;
            background: rgba(40, 167, 69, 0.2);
            border: 1px solid #28a745;
            margin-right: 0.5rem;
        }

        .control-group {
            margin-bottom: 1.5rem;
        }

        .control-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--dark-color);
        }

        button {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.2s ease;
            margin: 0.25rem;
        }

        button:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        button:disabled {
            background: var(--secondary-color);
            cursor: not-allowed;
            transform: none;
        }

        input[type="range"] {
            width: 100%;
            margin: 0.5rem 0;
        }

        .status-tag {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.875rem;
            font-weight: 600;
            margin: 0.25rem;
        }

        .tag-public {
            background: var(--public-color);
            color: var(--success-color);
        }

        .tag-private {
            background: var(--private-color);
            color: var(--danger-color);
        }

        .constraint-lights {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .constraint-light {
            display: flex;
            align-items: center;
            padding: 0.5rem;
            border-radius: 4px;
            background: #f8f9fa;
            border: 1px solid var(--border-color);
        }

        .constraint-light[title] {
            cursor: help;
        }

        .light-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 0.75rem;
            background: var(--constraint-off);
            transition: background-color 0.3s ease;
        }

        .light-indicator.on {
            background: var(--constraint-on);
            box-shadow: 0 0 8px rgba(40, 167, 69, 0.5);
        }

        .maze-grid {
            display: grid;
            grid-template-columns: repeat(8, 30px);
            grid-template-rows: repeat(8, 30px);
            gap: 1px;
            margin: 1rem 0;
        }

        .maze-cell {
            width: 30px;
            height: 30px;
            border: 1px solid #ccc;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }

        .maze-wall { background: #333; }
        .maze-path { background: #fff; }
        .maze-start { background: #28a745; color: white; }
        .maze-goal { background: #dc3545; color: white; }
        .maze-hidden { background: rgba(0,0,0,0.7); }
        .maze-revealed { background: #ffc107; }

        .color-cards {
            display: flex;
            gap: 2rem;
            margin: 1rem 0;
        }

        .color-card {
            width: 80px;
            height: 80px;
            border: 3px solid #333;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.7);
        }

        .confidence-chart {
            width: 100%;
            height: 100px;
            margin: 1rem 0;
        }

        #color-progress {
            width: 80%;
            height: 20px;
            margin: 0.5rem auto;
            display: block;
        }

        #color-probability {
            margin-top: 1rem;
            font-weight: bold;
            color: var(--primary-color);
            text-align: center;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 1.5rem 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .comparison-table th {
            background: var(--light-color);
            font-weight: 600;
            color: var(--primary-color);
        }

        .comparison-table tr:hover {
            background: rgba(0,123,255,0.05);
        }

        .explanation-card {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            border-left: 4px solid var(--info-color);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border-radius: 0 8px 8px 0;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            border-bottom: 1px dotted var(--primary-color);
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: var(--dark-color);
            color: white;
            text-align: center;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.875rem;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .result-panel {
            background: var(--light-color);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            text-align: center;
            margin: 1rem 0;
        }

        .result-panel.success {
            border-color: var(--success-color);
            background: var(--public-color);
        }

        .result-panel.failure {
            border-color: var(--danger-color);
            background: var(--private-color);
        }

        .step-indicator {
            margin-top: 1rem;
            padding: 0.75rem;
            text-align: center;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: #e9f7ff;
            font-weight: 500;
        }

        .step-indicator .step-number {
            font-weight: bold;
            font-size: 1.2rem;
            color: var(--primary-color);
            margin-right: 0.5rem;
        }

        .guide-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 1rem;
        }

        .guide-modal.active {
            display: flex;
        }

        .guide-modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 100%;
            text-align: center;
        }

        .guide-modal-content h2 {
            margin-top: 0;
        }

        @media (max-width: 480px) {
            .guide-modal-content {
                padding: 1.25rem;
            }
        }

        @media (max-width: 768px) {
            .demo-grid {
                grid-template-columns: 1fr;
            }
            
            .demo-body {
                grid-template-columns: 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .container {
                margin: 0;
            }
            
            /* 比較セクションのモバイル対応 */
            div[style*="grid-template-columns: 1fr 1fr"] {
                display: block !important;
            }
            div[style*="grid-template-columns: 1fr 1fr"] > div {
                margin-bottom: 15px !important;
            }
            /* 比較表のモバイル表示調整 */
            .comparison-table {
                font-size: 0.85rem;
            }
            .comparison-table th,
            .comparison-table td {
                padding: 8px;
            }
            /* フレックスボックスのモバイル調整 */
            div[style*="display: flex"] {
                flex-direction: column !important;
                gap: 10px !important;
            }
        }

        .summary-list {
            list-style: none;
            padding: 0;
        }

        .summary-list li {
            padding: 0.75rem;
            margin: 0.5rem 0;
            background: var(--light-color);
            border-left: 4px solid var(--primary-color);
            border-radius: 0 4px 4px 0;
        }

        .summary-list li::before {
            content: "✅ ";
            margin-right: 0.5rem;
        }
    </style>
</head>
<body>
    <div id="guide-modal" class="guide-modal" role="dialog" aria-modal="true">
        <div class="guide-modal-content">
            <h2>操作ガイド</h2>
            <p>上部のタブから「解説＆比較」「ZKP」「ZKML」「まとめ」を切り替えて体験できます。</p>
            <p>各デモの左パネルを操作すると、右の図と制約ライトが連動します。</p>
            <button id="guide-start">開始</button>
        </div>
    </div>
    <div class="container">
        <header>
            <h1>ZKP & ZKML 可視化デモ</h1>
            <p>「秘密は守る、検証は通す。与信も恋も、信頼が大事。」</p>
        </header>

        <nav class="tabs">
            <button class="tab-button active" onclick="openTab(event, 'intro')" aria-label="解説と比較">解説＆比較</button>
            <button class="tab-button" onclick="openTab(event, 'zkp')" aria-label="ゼロ知識証明デモ">ZKP</button>
            <button class="tab-button" onclick="openTab(event, 'zkml')" aria-label="ゼロ知識機械学習デモ">ZKML</button>
            <button class="tab-button" onclick="openTab(event, 'summary')" aria-label="まとめ">まとめ</button>
        </nav>

        <!-- 解説＆比較タブ -->
        <div id="intro" class="tab-content active">
            <h2>ZKP と ZKML の超要約解説</h2>
            
            <!-- 最重要ポイント：ZKMLの注目度 -->
            <div style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; padding: 25px; border-radius: 16px; margin: 20px 0; text-align: center; box-shadow: 0 8px 16px rgba(255, 107, 53, 0.3);">
                <div style="font-size: 2rem; margin-bottom: 15px;">🚀</div>
                <h3 style="color: white; margin: 0 0 15px 0; font-size: 1.4rem;">今、最も注目すべきは ZKML</h3>
                <div style="font-size: 1.1rem; margin-bottom: 15px;">ZKPは基盤技術、ZKMLはAI時代の実用化技術</div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; margin-top: 20px;">
                    <div style="font-size: 1rem; font-weight: bold;">✨ 特に金融×AI分野で革命的インパクト</div>
                    <div style="font-size: 0.9rem; opacity: 0.95; margin-top: 8px;">審査AI + プライバシー保護 + 第三者検証を同時実現</div>
                </div>
            </div>

            <!-- 基本概念の説明 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 25px 0;">
                <!-- ZKP -->
                <div style="background: linear-gradient(135deg, #6c5ce7 0%, #a29bfe 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);">
                    <div style="font-size: 1.8rem; margin-bottom: 15px;">🔐</div>
                    <h3 style="color: white; margin: 0 0 15px 0;">ZKP（基盤技術）</h3>
                    <div style="font-size: 1rem; font-weight: bold; margin-bottom: 10px;">「秘密を見せずに事実を証明」</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">パスワードを教えずに「知っている」ことや、年収額を明かさずに「500万円以上」であることを証明</div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.85rem;">
                        1980年代からの研究分野<br>暗号学の基礎理論
                    </div>
                </div>
                
                <!-- ZKML -->
                <div style="background: linear-gradient(135deg, #00b894 0%, #00cec9 100%); color: white; padding: 20px; border-radius: 12px; box-shadow: 0 6px 12px rgba(0, 184, 148, 0.3);">
                    <div style="font-size: 1.8rem; margin-bottom: 15px;">🤖</div>
                    <h3 style="color: white; margin: 0 0 15px 0;">ZKML（最新技術）</h3>
                    <div style="font-size: 1rem; font-weight: bold; margin-bottom: 10px;">「AI推論の正しさを証明」</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">審査AIのモデル・データを秘匿したまま「この承認判定は正しく計算されました」を第三者が検証可能</div>
                    <div style="background: rgba(255,255,255,0.2); padding: 10px; border-radius: 8px; margin-top: 15px; font-size: 0.85rem;">
                        2020年代の最新研究<br>AI×暗号学の実用化
                    </div>
                </div>
            </div>

            <!-- 進化の流れ -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 25px 0; border-left: 5px solid #17a2b8;">
                <h4 style="color: #17a2b8; margin-top: 0; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">📈</span>
                    技術進化の流れ
                </h4>
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0;">
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #6c5ce7; color: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">🔐 ZKP</div>
                        <div style="font-size: 0.9rem; color: #666;">1980年代〜<br>基礎理論</div>
                    </div>
                    <div style="font-size: 1.5rem; color: #17a2b8;">→</div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #fd79a8; color: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">⚡ 高速化</div>
                        <div style="font-size: 0.9rem; color: #666;">2010年代〜<br>実用化</div>
                    </div>
                    <div style="font-size: 1.5rem; color: #17a2b8;">→</div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: #00b894; color: white; padding: 10px; border-radius: 8px; margin-bottom: 10px;">🤖 ZKML</div>
                        <div style="font-size: 0.9rem; color: #666;">2020年代〜<br>AI時代の切り札</div>
                    </div>
                </div>
            </div>

            <!-- 詳細比較表 -->
            <h3>📊 詳細比較：何がそんなに違うのか？</h3>
            
            <div style="background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); padding: 20px; border-radius: 12px; margin: 20px 0; border-left: 5px solid #2196f3;">
                <h4 style="color: #1976d2; margin-top: 0;">🎯 決定的な違い</h4>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 15px 0;">
                    <div style="padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="text-align: center; font-size: 1.5rem; margin-bottom: 10px; color: #6c5ce7;">🔐</div>
                        <h5 style="color: #6c5ce7; text-align: center; margin: 0 0 10px 0;">ZKP</h5>
                        <p style="text-align: center; margin: 0; font-size: 0.9rem; color: #666;">「私はパスワードを知っています」<br><strong>シンプルな事実の証明</strong></p>
                    </div>
                    <div style="padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="text-align: center; font-size: 1.5rem; margin-bottom: 10px; color: #00b894;">🤖</div>
                        <h5 style="color: #00b894; text-align: center; margin: 0 0 10px 0;">ZKML</h5>
                        <p style="text-align: center; margin: 0; font-size: 0.9rem; color: #666;">「このAI推論は正しく実行されました」<br><strong>複雑な計算過程の証明</strong></p>
                    </div>
                </div>
            </div>

            <table class="comparison-table">
                <thead>
                    <tr>
                        <th>項目</th>
                        <th>🔐 ZKP（ゼロ知識証明）</th>
                        <th>🤖 ZKML（ゼロ知識機械学習）</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>🎯 証明対象</strong></td>
                        <td><span style="color: #6c5ce7;">📌</span> 秘密を見せずに「事実Aが正しい」を証明<br><small style="color: #666;">（パスワード知識、範囲証明など）</small></td>
                        <td><span style="color: #00b894;">🎯</span> モデル・データを見せずに「推論結果が正しい」を証明<br><small style="color: #666;">（AI計算の完全性保証）</small></td>
                    </tr>
                    <tr>
                        <td><strong>💡 複雑さ</strong></td>
                        <td><span style="color: #6c5ce7;">🔍</span> 比較的シンプルな論理<br><small style="color: #666;">（一致確認、大小比較など）</small></td>
                        <td><span style="color: #ff6b35;">🚀</span> 極めて複雑な計算<br><small style="color: #666;">（数千〜数百万の制約条件）</small></td>
                    </tr>
                    <tr>
                        <td><strong>🏢 実用例</strong></td>
                        <td><span style="color: #6c5ce7;">🔑</span> パスワード認証、年齢証明<br><small style="color: #666;">（個人レベルの秘密）</small></td>
                        <td><span style="color: #00b894;">🏦</span> 与信判定、不正検知、リスク評価<br><small style="color: #666;">（企業レベルの価値）</small></td>
                    </tr>
                    <tr>
                        <td><strong>⚡ 計算コスト</strong></td>
                        <td><span style="color: #6c5ce7;">🚀</span> 軽量（秒〜分レベル）<br><small style="color: #666;">（スマホでも実行可能）</small></td>
                        <td><span style="color: #ff6b35;">⏰</span> 重量（分〜時間レベル）<br><small style="color: #666;">（専用ハードウェア推奨）</small></td>
                    </tr>
                    <tr>
                        <td><strong>🌟 革新性</strong></td>
                        <td><span style="color: #6c5ce7;">📚</span> 確立された基礎技術<br><small style="color: #666;">（40年超の研究蓄積）</small></td>
                        <td><span style="color: #ff6b35;">🚀</span> 最先端の応用技術<br><small style="color: #666;">（AI×暗号の融合領域）</small></td>
                    </tr>
                    <tr>
                        <td><strong>💼 金融への影響</strong></td>
                        <td><span style="color: #6c5ce7;">🔐</span> プライバシー保護の向上<br><small style="color: #666;">（本人認証の強化）</small></td>
                        <td><span style="color: #ff6b35;">💥</span> 業界構造の変革<br><small style="color: #666;">（AI審査の透明化×秘匿化）</small></td>
                    </tr>
                </tbody>
            </table>

            <!-- 具体例で理解 -->
            <div style="background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); color: white; padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 6px 12px rgba(253, 121, 168, 0.3);">
                <h4 style="color: white; margin-top: 0; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 1.8rem;">💡</span>
                    具体例で理解：住宅ローン審査の場合
                </h4>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <!-- ZKP版 -->
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">🔐</span>
                            <strong>ZKP版</strong>
                        </div>
                        <div style="font-size: 0.9rem; line-height: 1.5;">
                            「年収を明かさずに、600万円以上であることを証明」<br>
                            <small style="opacity: 0.9;">→ シンプルな範囲証明</small>
                        </div>
                    </div>
                    
                    <!-- ZKML版 -->
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 12px;">
                            <span style="font-size: 1.5rem;">🤖</span>
                            <strong>ZKML版</strong>
                        </div>
                        <div style="font-size: 0.9rem; line-height: 1.5;">
                            「審査AIの判定プロセス全体を秘匿したまま、承認結果が正しく算出されたことを証明」<br>
                            <small style="opacity: 0.9;">→ 複雑なAI推論の完全証明</small>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 実装の複雑さについて -->
            <div class="explanation-card">
                <h3>🔧 実装の複雑さの違い</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div style="padding: 15px; background: #e8f4f8; border-radius: 8px; border-left: 4px solid #17a2b8;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">🔐</span>
                            <strong>ZKP実装</strong>
                        </div>
                        <ul style="font-size: 0.9rem; margin: 0; padding-left: 15px;">
                            <li>制約数：数十〜数百個</li>
                            <li>証明時間：秒レベル</li>
                            <li>回路サイズ：小規模</li>
                            <li>学習コスト：中程度</li>
                        </ul>
                    </div>
                    <div style="padding: 15px; background: #e8f8f0; border-radius: 8px; border-left: 4px solid #28a745;">
                        <div style="display: flex; align-items: center; gap: 8px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">🤖</span>
                            <strong>ZKML実装</strong>
                        </div>
                        <ul style="font-size: 0.9rem; margin: 0; padding-left: 15px;">
                            <li>制約数：数万〜数百万個</li>
                            <li>証明時間：分〜時間レベル</li>
                            <li>回路サイズ：超大規模</li>
                            <li>学習コスト：非常に高い</li>
                        </ul>
                    </div>
                </div>
                <p style="margin-top: 20px;"><strong>注意：</strong>本デモは教育用の概念可視化です。実際のZKP/ZKML実装には、算術回路、zk-SNARKs/STARKs、楕円曲線暗号などの専門知識が必要です。</p>
                <p style="font-size:0.95em;color:#888;">
                    参考: <a href="https://ddkang.github.io/papers/2024/zkml-eurosys.pdf" target="_blank" rel="noopener">ZKML実装例</a>・<a href="https://www.jri.co.jp/file/advanced/advanced-technology/pdf/15179.pdf" target="_blank" rel="noopener">ZKP解説資料</a>
                </p>
            </div>
        </div>

        <!-- ZKPタブ -->
        <div id="zkp" class="tab-content">
            <h2>ゼロ知識証明 (ZKP) デモ</h2>
            
            <div class="demo-grid">
                <!-- ZKP-1: 迷路デモ -->
                <div class="demo-section">
                    <div class="demo-header">
                        <h3>ZKP-1: 迷路「解けること」の証明</h3>
                        <p>経路を見せずに、ゴールに到達できることを証明</p>
                    </div>
                    <div class="demo-body">
                        <div class="controls">
                            <div class="control-group">
                                <label>証明手順</label>
                                <button id="maze-commit" onclick="mazeCommit()" title="コミット：解の存在を約束">1. コミット</button>
                                <button id="maze-challenge" onclick="mazeChallenge()" disabled title="チャレンジ：検証者からの質問">2. チャレンジ</button>
                                <button id="maze-response" onclick="mazeResponse()" disabled title="レスポンス：質問への回答">3. レスポンス</button>
                                <button id="maze-verify" onclick="mazeVerify()" disabled title="検証：回答の正しさを確認">4. 検証</button>
                            </div>
                            <div class="control-group">
                                <div id="maze-step-indicator" class="step-indicator">
                                    <span class="step-number">0/4</span> スタート → コミットを押してください
                                </div>
                            </div>
                            <div class="control-group">
                                <button onclick="resetMaze()">リセット</button>
                            </div>
                            <div class="control-group">
                                <div class="status-tag tag-private">🔒 秘密：経路</div>
                                <div class="status-tag tag-public">👁️ 公開：要求に沿う到達の瞬間だけ</div>
                            </div>
                        </div>
                        <div class="visualization">
                            <div class="maze-grid" id="maze-grid"></div>
                            <div class="result-panel" id="maze-result">
                                迷路デモを開始してください
                            </div>
                        </div>
                    </div>
                </div>

                <!-- ZKP-2: 色比較デモ -->
                <div class="demo-section">
                    <div class="demo-header">
                        <h3>ZKP-2: 色比較「同じ色か」の証明</h3>
                        <p>色コードを見せずに、2枚のカードが同色であることを証明</p>
                    </div>
                    <div class="demo-body">
                        <div class="controls">
                            <div class="control-group">
                                <label>繰り返し回数: <span id="color-rounds-value">5</span></label>
                                <input type="range" id="color-rounds" min="1" max="20" value="5" oninput="updateColorRounds()">
                            </div>
                            <div class="control-group">
                                <button onclick="startColorProof()" title="色比較証明を開始">証明開始</button>
                                <button onclick="resetColorProof()">リセット</button>
                            </div>
                            <div class="control-group">
                                <div class="status-tag tag-private">🔒 秘密：色コード</div>
                                <div class="status-tag tag-public">👁️ 公開：入れ替えの有無判定</div>
                            </div>
                        </div>
                        <div class="visualization">
                            <div class="color-cards">
                                <div class="color-card" id="color-card-a">A</div>
                                <div class="color-card" id="color-card-b">B</div>
                            </div>
                            <progress id="color-progress" value="0" max="1"></progress>
                            <svg class="confidence-chart" id="color-confidence-chart"></svg>
                            <div class="result-panel" id="color-result">
                                証明を開始してください
                            </div>
                            <div id="color-probability"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ZKMLタブ -->
        <div id="zkml" class="tab-content">
            <h2>ゼロ知識機械学習 (ZKML) デモ</h2>
            
            <div class="demo-grid">
                <!-- ZKML-1: 与信判定デモ -->
                <div class="demo-section">
                    <div class="demo-header">
                        <h3>ZKML-1: 与信「しきい値判定」のブラックボックス電卓</h3>
                        <p>入力と係数を秘匿したまま、計算が正しく行われたことを証明</p>
                    </div>
                    <div class="demo-body">
                        <div class="controls">
                            <div class="control-group">
                                <label>年収 (x1): <span id="credit-x1-value">500</span>万円</label>
                                <input type="range" id="credit-x1" min="100" max="2000" value="500" oninput="updateCredit()">
                            </div>
                            <div class="control-group">
                                <label>勤続年数 (x2): <span id="credit-x2-value">5</span>年</label>
                                <input type="range" id="credit-x2" min="0" max="30" value="5" oninput="updateCredit()">
                            </div>
                            <div class="control-group">
                                <label>係数 w1: <span id="credit-w1-value">2.0</span></label>
                                <input type="range" id="credit-w1" min="0.1" max="5.0" step="0.1" value="2.0" oninput="updateCredit()">
                            </div>
                            <div class="control-group">
                                <label>係数 w2: <span id="credit-w2-value">100</span></label>
                                <input type="range" id="credit-w2" min="10" max="500" step="10" value="100" oninput="updateCredit()">
                            </div>
                            <div class="control-group">
                                <label>バイアス b: <span id="credit-b-value">-200</span></label>
                                <input type="range" id="credit-b" min="-1000" max="1000" step="50" value="-200" oninput="updateCredit()">
                            </div>
                            <div class="control-group">
                                <div class="status-tag tag-private">🔒 非公開：入力と係数</div>
                                <div class="status-tag tag-public">👁️ 公開：合否と証明のみ</div>
                            </div>
                        </div>
                        <div class="visualization">
                            <div class="result-panel" id="credit-result">
                                計算中...
                            </div>
                            <div class="constraint-lights">
                                <div class="constraint-light" title="w1 × x1 の乗算結果が検証済み">
                                    <div class="light-indicator" id="credit-light-mul1"></div>
                                    <span>乗算1: w1 × x1</span>
                                </div>
                                <div class="constraint-light" title="w2 × x2 の乗算結果が検証済み">
                                    <div class="light-indicator" id="credit-light-mul2"></div>
                                    <span>乗算2: w2 × x2</span>
                                </div>
                                <div class="constraint-light" title="バイアス加算が検証済み">
                                    <div class="light-indicator" id="credit-light-add"></div>
                                    <span>加算: + b</span>
                                </div>
                                <div class="constraint-light" title="しきい値比較が検証済み">
                                    <div class="light-indicator" id="credit-light-comp"></div>
                                    <span>しきい値比較: ≥ 1000</span>
                                </div>
                            </div>
                            <p><small>審査ロジック秘匿 + 第三者検証の価値を実現</small></p>
                        </div>
                    </div>
                </div>

                <!-- ZKML-2: 2D分類デモ -->
                <div class="demo-section">
                    <div class="demo-header">
                        <h3>ZKML-2: 2D点の分類「右側です」の証明</h3>
                        <p>点の座標を隠したまま、境界線の右側にあることを証明</p>
                    </div>
                    <div class="demo-body">
                        <div class="controls">
                            <div class="control-group">
                                <label>境界 w1: <span id="boundary-w1-value">1.0</span></label>
                                <input type="range" id="boundary-w1" min="-3" max="3" step="0.1" value="1.0" oninput="updateBoundary()">
                            </div>
                            <div class="control-group">
                                <label>境界 w2: <span id="boundary-w2-value">-1.0</span></label>
                                <input type="range" id="boundary-w2" min="-3" max="3" step="0.1" value="-1.0" oninput="updateBoundary()">
                            </div>
                            <div class="control-group">
                                <label>境界 b: <span id="boundary-b-value">0.5</span></label>
                                <input type="range" id="boundary-b" min="-3" max="3" step="0.1" value="0.5" oninput="updateBoundary()">
                            </div>
                            <div class="control-group">
                                <div class="status-tag tag-private">🔒 秘密：点の正確な座標</div>
                                <div class="status-tag tag-public">👁️ 公開：「右側です」の証明のみ</div>
                            </div>
                        </div>
                        <div class="visualization">
                            <svg width="300" height="300" id="boundary-svg"></svg>
                            <div id="boundary-legend"></div>
                            <div class="constraint-lights">
                                <div class="constraint-light">
                                    <div class="light-indicator" id="boundary-light-mul1"></div>
                                    <span>w1 × x</span>
                                </div>
                                <div class="constraint-light">
                                    <div class="light-indicator" id="boundary-light-mul2"></div>
                                    <span>w2 × y</span>
                                </div>
                                <div class="constraint-light">
                                    <div class="light-indicator" id="boundary-light-add"></div>
                                    <span>+ b</span>
                                </div>
                                <div class="constraint-light">
                                    <div class="light-indicator" id="boundary-light-comp"></div>
                                    <span>符号確認: ≥ 0</span>
                                </div>
                            </div>
                            <div class="result-panel" id="boundary-result">
                                境界を調整してください
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- まとめタブ -->
        <div id="summary" class="tab-content">
            <h2>まとめ：ZKP と ZKML の共通する発想</h2>
            
            <!-- 最重要メッセージ：ZKMLへの注目 -->
            <div style="background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%); color: white; padding: 30px; border-radius: 16px; margin: 20px 0; text-align: center; box-shadow: 0 8px 16px rgba(255, 107, 53, 0.3);">
                <div style="font-size: 2.5rem; margin-bottom: 15px;">🚀</div>
                <h3 style="color: white; font-size: 1.5rem; margin: 0 0 15px 0;">重要：これからはZKMLの時代</h3>
                <div style="font-size: 1.2rem; font-weight: bold; margin-bottom: 15px;">AI審査時代の必須技術</div>
                <div style="font-size: 1rem; opacity: 0.95;">ZKPが築いた基礎の上に、ZKMLがAI×金融の未来を切り開く</div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; margin-top: 20px;">
                    <div style="font-size: 1rem; font-weight: bold;">💡 覚えておくべき核心</div>
                    <div style="font-size: 1.1rem; margin-top: 8px;">「秘密は守る、検証は通す。与信も恋も、信頼が大事。」</div>
                </div>
            </div>

            <!-- 技術進化の再確認 -->
            <div style="background: linear-gradient(135deg, #6c5ce7 0%, #00b894 100%); color: white; padding: 25px; border-radius: 16px; margin: 20px 0; box-shadow: 0 6px 12px rgba(108, 92, 231, 0.3);">
                <h3 style="color: white; margin: 0 0 20px 0; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 2rem;">📈</span>
                    技術進化の流れ（再確認）
                </h3>
                <div style="display: flex; align-items: center; gap: 15px; margin: 15px 0;">
                    <div style="text-align: center; flex: 1;">
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px;">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">🔐</div>
                            <div style="font-weight: bold;">ZKP</div>
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">基礎理論<br>（40年の歴史）</div>
                        </div>
                    </div>
                    <div style="font-size: 1.8rem; color: white;">→</div>
                    <div style="text-align: center; flex: 1;">
                        <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px;">
                            <div style="font-size: 1.5rem; margin-bottom: 8px;">🤖</div>
                            <div style="font-weight: bold;">ZKML</div>
                            <div style="font-size: 0.9rem; opacity: 0.9; margin-top: 5px;">実用化技術<br>（今まさに注目）</div>
                        </div>
                    </div>
                </div>
                <div style="text-align: center; margin-top: 20px; font-size: 1rem; opacity: 0.95;">
                    金融業界で求められているのは、まさに<strong>ZKML</strong>の能力
                </div>
            </div>

            <!-- 核心的価値の明確化 -->
            <div style="background: linear-gradient(135deg, #2196f3 0%, #1976d2 100%); color: white; padding: 25px; border-radius: 16px; margin: 20px 0; box-shadow: 0 8px 16px rgba(33, 150, 243, 0.3);">
                <h3 style="color: white; margin: 0 0 20px 0; display: flex; align-items: center; gap: 12px;">
                    <span style="font-size: 2rem;">🎯</span>
                    核心的なアイデア
                </h3>
                <div style="font-size: 1.3rem; font-weight: bold; margin-bottom: 20px; text-align: center;">
                    「計算の中身を明かすことなく、<br>その計算が正しく行われた事実だけを証明」
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin: 20px 0;">
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 8px;">🔒</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">何を？ (WHAT)</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">秘密にする</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; text-align: center;">
                        <div style="font-size: 1.5rem; margin-bottom: 8px;">✅</div>
                        <div style="font-weight: bold; margin-bottom: 5px;">正しいか？ (IF)</div>
                        <div style="font-size: 0.9rem; opacity: 0.9;">証明する</div>
                    </div>
                </div>
                
                <div style="text-align: center; margin-top: 20px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <strong>結果：</strong>「プライバシー保護」と「第三者検証」の両立
                </div>
            </div>

            <!-- 金融業界でのインパクト（具体的） -->
            <div style="background: linear-gradient(135deg, #4caf50 0%, #388e3c 100%); color: white; padding: 25px; border-radius: 16px; margin: 20px 0; box-shadow: 0 6px 12px rgba(76, 175, 80, 0.3);">
                <div style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                    <div style="font-size: 2rem;">💼</div>
                    <h3 style="color: white; margin: 0; font-size: 1.3rem;">金融業界での具体的インパクト</h3>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 15px; margin: 20px 0;">
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">⚖️</span>
                            <strong>規制・監査対応</strong>
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.95;">AI審査の計算過程を第三者が数学的に検証可能</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; margin-top: 8px; font-size: 0.8rem;">
                            → ZKMLの最大の強み
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">🛡️</span>
                            <strong>秘匿性の確保</strong>
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.95;">審査ロジックや顧客データを完全保護</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; margin-top: 8px; font-size: 0.8rem;">
                            → 競争優位性の維持
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">🤝</span>
                            <strong>顧客信頼の向上</strong>
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.95;">透明性と秘匿性を同時に実現した信頼関係</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; margin-top: 8px; font-size: 0.8rem;">
                            → 新たな競争軸
                        </div>
                    </div>
                    <div style="background: rgba(255,255,255,0.15); padding: 15px; border-radius: 8px;">
                        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 10px;">
                            <span style="font-size: 1.3rem;">📊</span>
                            <strong>モデルリスク管理</strong>
                        </div>
                        <div style="font-size: 0.9rem; opacity: 0.95;">AI推論の正しさを数学的に保証</div>
                        <div style="background: rgba(255,255,255,0.1); padding: 5px; border-radius: 4px; margin-top: 8px; font-size: 0.8rem;">
                            → リスク管理の高度化
                        </div>
                    </div>
                </div>
            </div>

            <!-- 実用化のタイムライン -->
            <div style="background: #f8f9fa; padding: 20px; border-radius: 12px; margin: 25px 0; border-left: 5px solid #fd79a8;">
                <h4 style="color: #e84393; margin-top: 0; display: flex; align-items: center; gap: 10px;">
                    <span style="font-size: 1.5rem;">🔮</span>
                    実用化のタイムライン
                </h4>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 15px 0;">
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 1.2rem; margin-bottom: 8px; color: #6c5ce7;">🔐</div>
                        <div style="font-weight: bold; color: #333; margin-bottom: 5px;">ZKP</div>
                        <div style="font-size: 0.9rem; color: #666;">すでに実用段階<br>（認証・プライバシー）</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); border: 2px solid #ff6b35;">
                        <div style="font-size: 1.2rem; margin-bottom: 8px; color: #ff6b35;">🤖</div>
                        <div style="font-weight: bold; color: #ff6b35; margin-bottom: 5px;">ZKML</div>
                        <div style="font-size: 0.9rem; color: #666;">今まさに実用化<br>（AI審査・検証）</div>
                    </div>
                    <div style="text-align: center; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <div style="font-size: 1.2rem; margin-bottom: 8px; color: #00b894;">🌟</div>
                        <div style="font-weight: bold; color: #333; margin-bottom: 5px;">将来</div>
                        <div style="font-size: 0.9rem; color: #666;">完全自動化<br>（リアルタイム証明）</div>
                    </div>
                </div>
            </div>

            <!-- 最終メッセージ -->
            <div style="background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%); color: white; padding: 25px; border-radius: 16px; margin: 20px 0; text-align: center; box-shadow: 0 6px 12px rgba(253, 121, 168, 0.3);">
                <div style="font-size: 2rem; margin-bottom: 15px;">💡</div>
                <div style="font-size: 1.4rem; font-weight: bold; margin-bottom: 15px;">次世代の金融AIに必須の技術</div>
                <div style="font-size: 1.2rem; font-weight: bold; text-shadow: 2px 2px 4px rgba(0,0,0,0.3); margin-bottom: 15px;">
                    「秘密は守る、検証は通す。<br>与信も恋も、信頼が大事。」
                </div>
                <div style="background: rgba(255,255,255,0.2); padding: 15px; border-radius: 12px; margin-top: 20px;">
                    <div style="font-size: 1rem; margin-bottom: 10px;">ZKMLが金融業界にもたらす変革</div>
                    <div style="display: flex; justify-content: center; gap: 15px; flex-wrap: wrap;">
                        <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 20px; font-size: 0.9rem;">AI審査の透明化</span>
                        <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 20px; font-size: 0.9rem;">プライバシー完全保護</span>
                        <span style="background: rgba(255,255,255,0.3); padding: 5px 10px; border-radius: 20px; font-size: 0.9rem;">第三者検証可能</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 簡易PRNG（デモ再現性のため）
        class SimpleRNG {
            constructor(seed = 12345) {
                this.seed = seed;
            }
            
            next() {
                this.seed = (this.seed * 9301 + 49297) % 233280;
                return this.seed / 233280;
            }
            
            nextInt(max) {
                return Math.floor(this.next() * max);
            }
        }
        
        const rng = new SimpleRNG();

        // タブ切り替え機能
        function openTab(evt, tabName) {
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            const tabButtons = document.getElementsByClassName('tab-button');
            for (let i = 0; i < tabButtons.length; i++) {
                tabButtons[i].classList.remove('active');
            }
            
            document.getElementById(tabName).classList.add('active');
            evt.currentTarget.classList.add('active');
        }

        // 迷路デモの状態
        let mazeState = {
            step: 0,
            challengeType: null, // 'start' or 'goal'
            path: [[0,0], [0,1], [1,1], [2,1], [2,2], [2,3], [3,3], [4,3], [5,3], [6,3], [7,3]],
            maze: [
                [1,1,0,0,0,0,0,0],
                [0,1,0,1,1,1,1,0],
                [0,1,1,1,0,0,1,0],
                [0,0,0,1,0,0,1,0],
                [1,1,0,1,0,0,1,0],
                [0,0,0,1,0,0,1,0],
                [0,1,1,1,0,0,1,0],
                [0,0,0,1,1,1,1,0]
            ]
        };

        // 迷路の初期化
        function initMaze() {
            const grid = document.getElementById('maze-grid');
            grid.innerHTML = '';
            
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'maze-cell';
                    cell.id = `maze-${i}-${j}`;
                    
                    if (mazeState.maze[i][j] === 0) {
                        cell.classList.add('maze-wall');
                    } else {
                        cell.classList.add('maze-path');
                    }
                    
                    if (i === 0 && j === 0) {
                        cell.classList.add('maze-start');
                        cell.textContent = 'S';
                    } else if (i === 7 && j === 3) {
                        cell.classList.add('maze-goal');
                        cell.textContent = 'G';
                    }
                    
                    grid.appendChild(cell);
                }
            }
        }

        // 迷路デモ：コミット
        function mazeCommit() {
            mazeState.step = 1;
            
            // 迷路を半透明で覆う
            for (let i = 0; i < 8; i++) {
                for (let j = 0; j < 8; j++) {
                    const cell = document.getElementById(`maze-${i}-${j}`);
                    if (!cell.classList.contains('maze-start') && !cell.classList.contains('maze-goal')) {
                        cell.classList.add('maze-hidden');
                    }
                }
            }
            
            document.getElementById('maze-commit').disabled = true;
            document.getElementById('maze-challenge').disabled = false;
            document.getElementById('maze-result').textContent = 'コミット完了：解の存在を約束しました';
            document.getElementById('maze-result').className = 'result-panel';
            document.getElementById('maze-step-indicator').innerHTML =
                '<span class="step-number">1/4</span> コミット完了 → 次はチャレンジを押してください';
        }

        // 迷路デモ：チャレンジ
        function mazeChallenge() {
            mazeState.step = 2;
            mazeState.challengeType = rng.nextInt(2) === 0 ? 'start' : 'goal';
            
            document.getElementById('maze-challenge').disabled = true;
            document.getElementById('maze-response').disabled = false;
            document.getElementById('maze-result').textContent =
                `チャレンジ：${mazeState.challengeType === 'start' ? '開始点' : '到達点'}を見せてください`;
            document.getElementById('maze-step-indicator').innerHTML =
                '<span class="step-number">2/4</span> チャレンジ完了 → レスポンスを押してください';
        }

        // 迷路デモ：レスポンス
        function mazeResponse() {
            mazeState.step = 3;
            
            if (mazeState.challengeType === 'start') {
                // 開始点周辺を表示
                const cell = document.getElementById('maze-0-0');
                cell.classList.remove('maze-hidden');
                cell.classList.add('maze-revealed');
            } else {
                // ゴール点周辺を表示
                const cell = document.getElementById('maze-7-3');
                cell.classList.remove('maze-hidden');
                cell.classList.add('maze-revealed');
            }
            
            document.getElementById('maze-response').disabled = true;
            document.getElementById('maze-verify').disabled = false;
            document.getElementById('maze-result').textContent =
                `レスポンス：要求された${mazeState.challengeType === 'start' ? '開始点' : '到達点'}を表示`;
            document.getElementById('maze-step-indicator').innerHTML =
                '<span class="step-number">3/4</span> レスポンス完了 → 次は検証を押してください';
        }

        // 迷路デモ：検証
        function mazeVerify() {
            mazeState.step = 4;
            
            document.getElementById('maze-verify').disabled = true;
            document.getElementById('maze-result').textContent = '検証成功：要求に正しく応答しました';
            document.getElementById('maze-result').className = 'result-panel success';
            document.getElementById('maze-step-indicator').innerHTML =
                '<span class="step-number">4/4</span> 検証完了 → リセットで再体験できます';
        }

        // 迷路デモ：リセット
        function resetMaze() {
            mazeState.step = 0;
            mazeState.challengeType = null;
            
            document.getElementById('maze-commit').disabled = false;
            document.getElementById('maze-challenge').disabled = true;
            document.getElementById('maze-response').disabled = true;
            document.getElementById('maze-verify').disabled = true;
            document.getElementById('maze-result').textContent = '迷路デモを開始してください';
            document.getElementById('maze-result').className = 'result-panel';

            initMaze();
            document.getElementById('maze-step-indicator').innerHTML =
                '<span class="step-number">0/4</span> スタート → コミットを押してください';
        }

        // 色比較デモの状態
        let colorState = {
            rounds: 5,
            results: [],
            cardA: '#3498db',
            cardB: '#3498db' // 同じ色
        };

        // 色比較デモ：繰り返し回数更新
        function updateColorRounds() {
            colorState.rounds = parseInt(document.getElementById('color-rounds').value);
            document.getElementById('color-rounds-value').textContent = colorState.rounds;
        }

        // 色比較デモ：開始
        async function startColorProof() {
            colorState.results = [];

            const progress = document.getElementById('color-progress');
            progress.value = 0;
            progress.max = colorState.rounds;
            const resultPanel = document.getElementById('color-result');
            resultPanel.textContent = `試行 0/${colorState.rounds}`;
            resultPanel.className = 'result-panel';
            document.getElementById('color-probability').textContent = '';

            // カードの色を設定
            document.getElementById('color-card-a').style.backgroundColor = colorState.cardA;
            document.getElementById('color-card-b').style.backgroundColor = colorState.cardB;

            // 繰り返し実行
            for (let i = 0; i < colorState.rounds; i++) {
                // 入れ替えるかどうかをランダムに決定
                const swap = rng.nextInt(2) === 1;

                // 同じ色なので、入れ替えても見分けがつかない（常に正解）
                colorState.results.push(true);

                progress.value = i + 1;
                resultPanel.textContent = `試行 ${i + 1}/${colorState.rounds}`;
                await new Promise(resolve => setTimeout(resolve, 300));
            }

            // 信頼度を計算（正解率）
            const confidence = colorState.results.filter(r => r).length / colorState.results.length;

            // グラフを更新
            updateConfidenceChart(confidence);

            // 結果を表示
            resultPanel.textContent =
                `証明完了：${colorState.rounds}回中${colorState.results.filter(r => r).length}回正解（信頼度: ${(confidence * 100).toFixed(1)}%）`;
            resultPanel.className = 'result-panel success';

            const failProb = Math.pow(0.5, colorState.rounds);
            document.getElementById('color-probability').textContent =
                `異なる色が見抜かれない確率は ${(failProb * 100).toFixed(2)}% です。`;
        }

        // 信頼度チャートの更新
        function updateConfidenceChart(confidence) {
            const svg = document.getElementById('color-confidence-chart');
            svg.innerHTML = '';
            
            // 背景
            const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            rect.setAttribute('x', '0');
            rect.setAttribute('y', '0');
            rect.setAttribute('width', '100%');
            rect.setAttribute('height', '100%');
            rect.setAttribute('fill', '#f8f9fa');
            rect.setAttribute('stroke', '#dee2e6');
            svg.appendChild(rect);
            
            // 信頼度バー
            const bar = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            bar.setAttribute('x', '10');
            bar.setAttribute('y', '20');
            bar.setAttribute('width', `${confidence * 80}%`);
            bar.setAttribute('height', '60');
            bar.setAttribute('fill', '#28a745');
            svg.appendChild(bar);
            
            // テキスト
            const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            text.setAttribute('x', '50%');
            text.setAttribute('y', '55');
            text.setAttribute('text-anchor', 'middle');
            text.setAttribute('fill', '#333');
            text.textContent = `信頼度: ${(confidence * 100).toFixed(1)}%`;
            svg.appendChild(text);
        }

        // 色比較デモ：リセット
        function resetColorProof() {
            colorState.results = [];
            document.getElementById('color-result').textContent = '証明を開始してください';
            document.getElementById('color-result').className = 'result-panel';
            document.getElementById('color-probability').textContent = '';
            const progress = document.getElementById('color-progress');
            progress.value = 0;
            progress.max = 1;

            const svg = document.getElementById('color-confidence-chart');
            svg.innerHTML = '';
        }

        // 与信判定デモの状態
        let creditState = {
            x1: 500, // 年収
            x2: 5,   // 勤続年数
            w1: 2.0,
            w2: 100,
            b: -200,
            threshold: 1000
        };

        // 与信判定デモ：更新
        function updateCredit() {
            creditState.x1 = parseFloat(document.getElementById('credit-x1').value);
            creditState.x2 = parseFloat(document.getElementById('credit-x2').value);
            creditState.w1 = parseFloat(document.getElementById('credit-w1').value);
            creditState.w2 = parseFloat(document.getElementById('credit-w2').value);
            creditState.b = parseFloat(document.getElementById('credit-b').value);
            
            // 表示値を更新
            document.getElementById('credit-x1-value').textContent = creditState.x1;
            document.getElementById('credit-x2-value').textContent = creditState.x2;
            document.getElementById('credit-w1-value').textContent = creditState.w1;
            document.getElementById('credit-w2-value').textContent = creditState.w2;
            document.getElementById('credit-b-value').textContent = creditState.b;
            
            // スコア計算
            const score = creditState.w1 * creditState.x1 + creditState.w2 * creditState.x2 + creditState.b;
            const approved = score >= creditState.threshold;
            
            // 制約ライトを更新
            document.getElementById('credit-light-mul1').classList.add('on');
            document.getElementById('credit-light-mul2').classList.add('on');
            document.getElementById('credit-light-add').classList.add('on');
            document.getElementById('credit-light-comp').classList.toggle('on', approved);
            
            // 結果を表示
            const resultPanel = document.getElementById('credit-result');
            resultPanel.textContent = approved ? '承認' : '否認';
            resultPanel.className = approved ? 'result-panel success' : 'result-panel failure';
        }

        // 境界分類デモの状態
        let boundaryState = {
            w1: 1.0,
            w2: -1.0,
            b: 0.5,
            pointX: 2.0,
            pointY: 1.0
        };

        // 境界分類デモ：更新
        function updateBoundary() {
            boundaryState.w1 = parseFloat(document.getElementById('boundary-w1').value);
            boundaryState.w2 = parseFloat(document.getElementById('boundary-w2').value);
            boundaryState.b = parseFloat(document.getElementById('boundary-b').value);
            
            // 表示値を更新
            document.getElementById('boundary-w1-value').textContent = boundaryState.w1;
            document.getElementById('boundary-w2-value').textContent = boundaryState.w2;
            document.getElementById('boundary-b-value').textContent = boundaryState.b;
            
            // 分類計算
            const value = boundaryState.w1 * boundaryState.pointX + boundaryState.w2 * boundaryState.pointY + boundaryState.b;
            const rightSide = value >= 0;
            
            // 制約ライトを更新
            document.getElementById('boundary-light-mul1').classList.add('on');
            document.getElementById('boundary-light-mul2').classList.add('on');
            document.getElementById('boundary-light-add').classList.add('on');
            document.getElementById('boundary-light-comp').classList.toggle('on', rightSide);
            
            // SVGを更新
            updateBoundarySVG();
            
            // 結果を表示
            const resultPanel = document.getElementById('boundary-result');
            resultPanel.textContent = rightSide ? '右側です（クラス1）' : '左側です（クラス0）';
            resultPanel.className = rightSide ? 'result-panel success' : 'result-panel failure';
        }

        // 境界SVGの更新
        function updateBoundarySVG() {
            const svg = document.getElementById('boundary-svg');
            svg.innerHTML = '';

            const legend = document.getElementById('boundary-legend');
            legend.innerHTML = `
                <div class="legend-item"><span class="legend-line"></span>青線: 境界</div>
                <div class="legend-item"><span class="legend-box"></span>緑色の帯: 証明された右側領域</div>
            `;

            // 背景
            const bg = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
            bg.setAttribute('width', '100%');
            bg.setAttribute('height', '100%');
            bg.setAttribute('fill', '#f8f9fa');
            bg.setAttribute('stroke', '#dee2e6');
            svg.appendChild(bg);
            
            // 座標軸
            const axisX = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            axisX.setAttribute('x1', '0');
            axisX.setAttribute('y1', '150');
            axisX.setAttribute('x2', '300');
            axisX.setAttribute('y2', '150');
            axisX.setAttribute('stroke', '#ccc');
            svg.appendChild(axisX);
            
            const axisY = document.createElementNS('http://www.w3.org/2000/svg', 'line');
            axisY.setAttribute('x1', '150');
            axisY.setAttribute('y1', '0');
            axisY.setAttribute('x2', '150');
            axisY.setAttribute('y2', '300');
            axisY.setAttribute('stroke', '#ccc');
            svg.appendChild(axisY);
            
            // 境界線 w1*x + w2*y + b = 0
            if (Math.abs(boundaryState.w2) > 0.001) {
                const y1 = (-boundaryState.w1 * (-3) - boundaryState.b) / boundaryState.w2;
                const y2 = (-boundaryState.w1 * 3 - boundaryState.b) / boundaryState.w2;
                
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', ((-3) * 50 + 150).toString());
                line.setAttribute('y1', ((-y1) * 50 + 150).toString());
                line.setAttribute('x2', ((3) * 50 + 150).toString());
                line.setAttribute('y2', ((-y2) * 50 + 150).toString());
                line.setAttribute('stroke', '#007bff');
                line.setAttribute('stroke-width', '2');
                svg.appendChild(line);
            }
            
            // 右側領域をハイライト
            const value = boundaryState.w1 * boundaryState.pointX + boundaryState.w2 * boundaryState.pointY + boundaryState.b;
            if (value >= 0) {
                const highlight = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                highlight.setAttribute('x', '150');
                highlight.setAttribute('y', '0');
                highlight.setAttribute('width', '150');
                highlight.setAttribute('height', '300');
                highlight.setAttribute('fill', 'rgba(40, 167, 69, 0.2)');
                svg.appendChild(highlight);
                
                const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                text.setAttribute('x', '225');
                text.setAttribute('y', '30');
                text.setAttribute('text-anchor', 'middle');
                text.setAttribute('fill', '#28a745');
                text.setAttribute('font-weight', 'bold');
                text.textContent = '右側です';
                svg.appendChild(text);
            }
            
            // ぼかした点（位置は非公開）
            const blurredPoint = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
            blurredPoint.setAttribute('cx', '200');
            blurredPoint.setAttribute('cy', '100');
            blurredPoint.setAttribute('r', '20');
            blurredPoint.setAttribute('fill', 'rgba(220, 53, 69, 0.3)');
            blurredPoint.setAttribute('stroke', '#dc3545');
            blurredPoint.setAttribute('stroke-width', '2');
            blurredPoint.setAttribute('stroke-dasharray', '5,5');
            svg.appendChild(blurredPoint);
            
            const pointText = document.createElementNS('http://www.w3.org/2000/svg', 'text');
            pointText.setAttribute('x', '200');
            pointText.setAttribute('y', '105');
            pointText.setAttribute('text-anchor', 'middle');
            pointText.setAttribute('fill', '#dc3545');
            pointText.setAttribute('font-size', '12');
            pointText.textContent = '?';
            svg.appendChild(pointText);
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            initMaze();
            updateCredit();
            updateBoundary();

            // 色カードの初期化
            document.getElementById('color-card-a').style.backgroundColor = colorState.cardA;
            document.getElementById('color-card-b').style.backgroundColor = colorState.cardB;

            const guideModal = document.getElementById('guide-modal');
            const guideStart = document.getElementById('guide-start');
            if (!localStorage.getItem('guideModalShown')) {
                guideModal.classList.add('active');
            }
            guideStart.addEventListener('click', function() {
                guideModal.classList.remove('active');
                localStorage.setItem('guideModalShown', 'true');
            });
        });
    </script>
</body>
</html>
